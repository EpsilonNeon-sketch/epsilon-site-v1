<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epsilon | The Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Epsilon Hub">
    <link rel="apple-touch-icon" href="./epsilon logo.png">
    <link rel="icon"  href="./epsilon logo.png">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: #ffffff;
            overflow-x: hidden;
        }

        .purple-glow {
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.15);
        }

        .card-gradient:hover {
            background: linear-gradient(145deg, #121212 0%, #1a1025 100%);
            border-color: rgba(168, 85, 247, 0.5);
            transform: translateY(-5px);
        }

        .glass {
            background: rgba(18, 18, 18, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .bg-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: 
                radial-gradient(at 0% 0%, hsla(273, 67%, 15%, 1) 0, transparent 50%), 
                radial-gradient(at 100% 100%, hsla(273, 67%, 10%, 1) 0, transparent 50%);
        }
        .img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
        }
        #members { 
            margin-bottom: 40px;
        }
        .mb {
            margin-bottom: 20px;
        }
        .inpu-s {
            height: 30px;
            width: 600px;
            margin-bottom: 40px;
            color: black;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .post-card {
            transition: all 0.3s ease;
        }
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(168, 85, 247, 0.2);
        }
        .profile-pic-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #a855f7;
        }
        .story-textarea {
            min-height: 150px;
            resize: vertical;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        .notification.success {
            background-color: #10b981;
        }
        .notification.error {
            background-color: #ef4444;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* Mobile Optimizations */
@media (max-width: 768px) {
    /* Navigation adjustments */
    .fixed.top-6.right-6 {
        top: 1rem;
        right: 1rem;
        flex-wrap: wrap;
        max-width: calc(100% - 2rem);
        justify-content: flex-end;
    }
    
    .fixed.top-6.right-6 button {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
    }
    
    .fixed.top-6.right-6 button span {
        display: none;
    }
    
    /* Search input */
    .inpu-s {
        width: 100%;
        max-width: 100%;
    }
    
    /* Card adjustments */
    .glass.p-6.md\:p-8 {
        padding: 1.5rem;
    }
    
    /* Profile images */
    .img {
        width: 120px;
        height: 120px;
    }
    
    /* Dialogs for mobile */
    dialog {
        width: 95vw;
        max-width: 95vw;
        margin: auto;
    }
    
    /* Post cards */
    .post-card {
        margin-bottom: 1rem;
    }
    
    /* Form inputs */
    input, textarea, select {
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    /* Footer */
    footer {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    /* Settings page */
    #settingsPage .flex-col.md\:flex-row {
        flex-direction: column;
    }
    
    /* Admin panel */
    #adminPanel {
        width: 95vw;
    }
    
    /* Modal content */
    .bg-\[\#18181b\].text-white.rounded-xl.p-8 {
        padding: 1.5rem;
        max-height: 90vh;
        overflow-y: auto;
    }
}

/* Touch-friendly tap targets */
@media (pointer: coarse) {
    button, a {
        min-height: 44px;
        min-width: 44px;
    }
}

/* Prevent horizontal scroll */
body {
    overflow-x: hidden;
    width: 100%;
}

/* Better mobile typography */
@media (max-width: 640px) {
    h1 {
        font-size: 2.5rem;
        line-height: 1.2;
    }
    
    h2 {
        font-size: 1.5rem;
        line-height: 1.3;
    }
    
    p {
        font-size: 0.95rem;
        line-height: 1.5;
    }
}

/* Mobile-safe dialog positioning */
dialog[open] {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

/* Better mobile form experience */
@media (max-width: 768px) {
    .grid.grid-cols-1.md\:grid-cols-2.gap-4 {
        grid-template-columns: 1fr;
    }
}
/* Mobile-specific styles for Stories Page */
@media (max-width: 768px) {
  /* Posts container adjustments */
  #postsPage .grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  /* Post cards optimization */
  .post-card {
    padding: 1rem !important;
    border-radius: 1.5rem !important;
  }
  
  /* Author info in post cards */
  .post-card .flex.items-center.mb-4 {
    margin-bottom: 0.75rem !important;
  }
  
  .post-card .w-10.h-10 {
    width: 2.5rem !important;
    height: 2.5rem !important;
  }
  
  /* Post title and content */
  .post-card h2 {
    font-size: 1.25rem !important;
    line-height: 1.4 !important;
    margin-bottom: 0.75rem !important;
  }
  
  .post-card p {
    font-size: 0.9rem !important;
    line-height: 1.5 !important;
    margin-bottom: 1rem !important;
  }
  
  /* Category tags */
  .post-card .mb-3 {
    margin-bottom: 0.75rem !important;
  }
  
  .post-card .text-xs.px-2.py-1 {
    font-size: 0.7rem !important;
    padding: 0.25rem 0.5rem !important;
  }
  
  /* Action buttons */
  .post-card .flex.justify-between.items-center {
    margin-top: 1rem !important;
  }
  
  .post-card .like-btn, .post-card .read-more-btn {
    padding: 0.5rem !important;
    font-size: 0.8rem !important;
  }
  
  /* Filter buttons */
  #postsPage .flex.gap-2 {
    flex-wrap: wrap;
    gap: 0.5rem !important;
    margin-bottom: 1rem !important;
  }
  
  #postsPage .filter-btn {
    padding: 0.5rem 0.75rem !important;
    font-size: 0.75rem !important;
    border-radius: 9999px !important;
  }
  
  /* Create post form */
  #createPostSection {
    padding: 1rem !important;
    margin-bottom: 1rem !important;
  }
  
  #createPostSection h2 {
    font-size: 1.25rem !important;
    margin-bottom: 1rem !important;
  }
  
  #postForm .space-y-4 > div {
    margin-bottom: 0.75rem !important;
  }
  
  #postForm label {
    font-size: 0.75rem !important;
    margin-bottom: 0.5rem !important;
  }
  
  #postForm input, #postForm textarea, #postForm select {
    padding: 0.75rem !important;
    font-size: 0.9rem !important;
  }
  
  #postForm .flex.justify-end.gap-2 {
    margin-top: 1rem !important;
  }
  
  #postForm button {
    padding: 0.75rem 1rem !important;
    font-size: 0.9rem !important;
  }
  
  /* Empty state */
  #emptyState {
    padding: 2rem 1rem !important;
  }
  
  #emptyState h3 {
    font-size: 1.25rem !important;
    margin-bottom: 0.75rem !important;
  }
  
  #emptyState p {
    font-size: 0.9rem !important;
    margin-bottom: 1.5rem !important;
  }
  
  /* Modal for full posts */
  dialog .bg-\[\#18181b\] {
    padding: 1.5rem !important;
    max-width: 95vw !important;
    max-height: 90vh !important;
    overflow-y: auto !important;
  }
  
  dialog .flex.justify-between.items-start.mb-6 {
    margin-bottom: 1rem !important;
  }
  
  dialog .w-12.h-12 {
    width: 3rem !important;
    height: 3rem !important;
  }
  
  dialog h2 {
    font-size: 1.5rem !important;
    margin-bottom: 0.75rem !important;
  }
  
  dialog .text-gray-300 {
    font-size: 0.9rem !important;
    line-height: 1.5 !important;
  }
  
  dialog .flex.justify-between.items-center.pt-4 {
    padding-top: 1rem !important;
  }
  
  dialog button {
    padding: 0.75rem 1rem !important;
    font-size: 0.9rem !important;
  }
}

/* Small phones specific adjustments */
@media (max-width: 480px) {
  /* Even more compact post cards */
  .post-card {
    padding: 0.75rem !important;
  }
  
  .post-card h2 {
    font-size: 1.1rem !important;
  }
  
  .post-card p {
    font-size: 0.85rem !important;
  }
  
  /* Smaller touch targets but still accessible */
  .post-card .like-btn, .post-card .read-more-btn {
    padding: 0.4rem 0.6rem !important;
    font-size: 0.75rem !important;
  }
  
  /* More compact form */
  #createPostSection {
    padding: 0.75rem !important;
  }
  
  #postForm input, #postForm textarea, #postForm select {
    padding: 0.6rem !important;
    font-size: 0.85rem !important;
  }
}
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-12 px-6">
    <div class="bg-mesh"></div>

    <!-- Navigation -->
    <div class="fixed top-6 right-6 flex gap-4 z-50">
        <button id="homeBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all flex items-center gap-2">
            <i data-lucide="home" class="w-4 h-4"></i> <span>Home</span>
        </button>
        <button id="postsBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all flex items-center gap-2">
            <i data-lucide="book-open" class="w-4 h-4"></i> <span>Stories</span>
        </button>
        <button id="authBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all flex items-center gap-2">
            <i data-lucide="user" class="w-4 h-4"></i> <span id="authBtnText">Join Epsilon</span>
        </button>
        <button id="settingsBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all hidden flex items-center gap-2">
            <i data-lucide="settings" class="w-4 h-4"></i> Settings
        </button>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="page active">
        <!-- Header Section -->
        <header class="text-center mb-12 space-y-4">
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tighter italic">
                EPSILON<span class="text-purple-500">.</span>
            </h1>
            <p class="text-gray-400 font-light tracking-widest uppercase text-[10px] md:text-sm">-BY warren adrian and epsilon team</p>
        </header>

        <section id="members" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 w-full max-w-6xl mb-16">
            <div id="warren" class="flex flex-col items-center text-center md:items-start md:text-left">
                <img src="./warren img.png" class="img mb-4">
                <div class="space-y-1">
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Name:</span> Warren</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Age:</span> 13</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Role:</span> Owner, Founder</p>
                </div>
            </div>
            <div id="ethan" class="flex flex-col items-center text-center md:items-start md:text-left">
                <img src="./ethan img.png" class="img mb-4">
                <div class="space-y-1">
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Name:</span> Ethan</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Age:</span> 13</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Role:</span> Co-Owner, Co-Founder</p>
                </div>
            </div>
            <div id="richard" class="flex flex-col items-center text-center md:items-start md:text-left">
                <img src="./richard img.png" class="img mb-4">
                <div class="space-y-1">
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Name:</span> Richard</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Age:</span> 13</p>
                    <p class="text-sm font-medium"><span class="text-purple-500 font-bold uppercase text-xs tracking-wider">Role:</span> Experimentor</p>
                </div>
            </div>
        </section>
        <!-- Main Grid -->
        <input type="text" id="search" placeholder="search..." class="inpu-s">
        <div class="max-w-6xl w-full space-y-12 md:space-y-20">
            
            <!-- Primary Ecosystem -->
            <section>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Epsilon Aproxi -->
                    <a href="https://epsilonneon-sketch.github.io/epsilon-aproxi-v2/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                    <i data-lucide="database"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Epsilon Aproxi</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">High-performance BMS (Business Management System) built for scale and speed.</p>
                            </div>
                            <div class="mt-8 flex items-center text-purple-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                Launch System <i data-lucide="arrow-right" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>

                    <!-- Epsilon Heckle -->
                    <a href="https://epsilonneon-sketch.github.io/epsilon-heckle-v1/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                    <i data-lucide="gamepad-2"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Epsilon Heckle</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">The ultimate gaming destination. Competitive, fast, and optimized for performance.</p>
                            </div>
                            <div class="mt-8 flex items-center text-purple-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                Enter Arena <i data-lucide="arrow-right" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>

                    <!-- Epsilon Editz -->
                    <a href="https://epsilonneon-sketch.github.io/epsilon-editz-v2/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                    <i data-lucide="clapperboard"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Epsilon Editz</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">Professional-grade editing tools and creative resources for modern creators.</p>
                            </div>
                            <div class="mt-8 flex items-center text-purple-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                Open Studio <i data-lucide="arrow-right" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>
                </div>
            </section>

            <!-- Partners Section -->
            <section class="space-y-8">
                <div class="flex items-center gap-4">
                    <div class="h-px flex-1 bg-gradient-to-r from-transparent to-purple-500/30"></div>
                    <h3 class="text-gray-500 uppercase tracking-[0.3em] text-xs font-bold">Strategic Partners</h3>
                    <div class="h-px flex-1 bg-gradient-to-l from-transparent to-purple-500/30"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- NTK Services -->
                    <a href="https://epsilonneon-sketch.github.io/NTK-MOVERS-AND-SERVICES/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-blue-600/20 rounded-2xl flex items-center justify-center mb-6 text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <i data-lucide="briefcase"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">NTK Services</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">Premium movers and professional logistics services delivered with precision.</p>
                            </div>
                            <div class="mt-8 flex items-center text-blue-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                View Services <i data-lucide="external-link" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>
                    <!--Zerah-->
                     <a href="https://epsilonneon-sketch.github.io/zerah-v1/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-blue-600/20 rounded-2xl flex items-center justify-center mb-6 text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <i data-lucide="sparkles"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Zerah</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">Premium stationary and clothing items.</p>
                            </div>
                            <div class="mt-8 flex items-center text-blue-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                View Services <i data-lucide="external-link" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Placeholder for future partners (Empty Glass Card) -->
                    <div class="glass p-6 md:p-8 rounded-3xl border border-dashed border-white/10 flex items-center justify-center text-gray-600 italic text-sm">
                        New Partners Coming Soon...
                    </div>
                </div>
            </section>
            <section>
                 <div class="flex items-center gap-4">
                    <div class="h-px flex-1 bg-gradient-to-r from-transparent to-purple-500/30"></div>
                    <h3 class="text-gray-500 uppercase tracking-[0.3em] text-xs font-bold">Epsilon Labs</h3>
                    <div class="h-px flex-1 bg-gradient-to-l from-transparent to-purple-500/30"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <a href="https://epsilonneon-sketch.github.io/epsilon-neote-v1/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                    <i data-lucide="terminal"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Epsilon Neote</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">Custom programming language that transpiles to javascript.</p>
                            </div>
                            <div class="mt-8 flex items-center text-purple-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                Open IDE <i data-lucide="arrow-right" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>
                
                    <a href="https://epsilonneon-sketch.github.io/epsilon-academics/" class="group">
                        <div class="glass p-6 md:p-8 rounded-3xl transition-all duration-300 card-gradient border border-white/5 h-full flex flex-col justify-between">
                            <div>
                                <div class="w-12 h-12 bg-purple-600/20 rounded-2xl flex items-center justify-center mb-6 text-purple-400 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                    <i data-lucide="graduation-cap"></i>
                                </div>
                                <h2 class="text-2xl font-bold mb-2">Epsilon Academics</h2>
                                <p class="text-gray-400 text-sm leading-relaxed">Learn and grow all for free no costs.</p>
                            </div>
                            <div class="mt-8 flex items-center text-purple-400 font-semibold text-sm group-hover:translate-x-2 transition-transform">
                                Open learning place <i data-lucide="arrow-right" class="ml-2 w-4 h-4"></i>
                            </div>
                        </div>
                    </a>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="mt-20 text-gray-600 text-xs flex gap-6">
            <p>&copy; 2024 EPSILON LABS</p>
            <a href="#" class="hover:text-purple-400 transition-colors">TERMS</a>
            <a href="#" class="hover:text-purple-400 transition-colors">PRIVACY</a>
            <button id="adminBtn" class="ml-6 px-4 py-1 rounded bg-purple-700 text-white hover:bg-purple-800 transition-colors">Admin</button>
        </footer>
    </div>

    <!-- Posts Page -->
    <div id="postsPage" class="page">
        <div class="max-w-6xl w-full">
            <header class="text-center mb-12 space-y-4">
                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tighter italic">
                    EPSILON<span class="text-purple-500"> STORIES</span>
                </h1>
                <p class="text-gray-400 font-light tracking-widest uppercase text-[10px] md:text-sm">Share your creativity with the community</p>
            </header>

            <!-- Create Post Section (only visible when logged in) -->
            <div id="createPostSection" class="glass p-6 rounded-3xl mb-8 hidden">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="pen-tool" class="text-purple-500"></i> Create a New Story
                </h2>
                <form id="postForm" class="space-y-4">
                    <div>
                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Title</label>
                        <input id="postTitle" type="text" placeholder="Your story title..." class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                    </div>
                    <div>
                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Category</label>
                        <select id="postCategory" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                            <option value="tech">Technology</option>
                            <option value="creative">Creative</option>
                            <option value="personal">Personal</option>
                            <option value="tutorial">Tutorial</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Story Content</label>
                        <textarea id="postContent" placeholder="Share your story..." class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all story-textarea" required></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelPost" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">Cancel</button>
                        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">Publish Story</button>
                    </div>
                </form>
            </div>

            <!-- Filter Section -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex gap-2">
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all active" data-filter="all">All</button>
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all" data-filter="tech">Technology</button>
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all" data-filter="creative">Creative</button>
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all" data-filter="personal">Personal</button>
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all" data-filter="tutorial">Tutorial</button>
                    <button class="filter-btn glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all" data-filter="other">Other</button>
                </div>
                <button id="newPostBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all flex items-center gap-2 hidden">
                    <i data-lucide="plus" class="w-4 h-4"></i> <span>New Story</span>
                </button>
            </div>

            <!-- Posts Container -->
            <div id="postsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Posts will be dynamically added here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12">
                <i data-lucide="book-open" class="w-16 h-16 mx-auto text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">No stories yet</h3>
                <p class="text-gray-400 mb-6">Be the first to share a story with the community!</p>
                <button id="emptyStateNewPostBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg hidden">Create Your First Story</button>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="page">
        <div class="max-w-4xl w-full">
            <header class="text-center mb-12 space-y-4">
                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tighter italic">
                    SETTINGS<span class="text-purple-500">.</span>
                </h1>
                <p class="text-gray-400 font-light tracking-widest uppercase text-[10px] md:text-sm">Manage your account and preferences</p>
            </header>

            <div class="glass p-8 rounded-3xl">
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Profile Picture Section -->
                    <div class="flex flex-col items-center">
                        <img id="profilePicPreview" src="https://picsum.photos/seed/epsilon/200/200.jpg" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover mb-4 border-4 border-purple-500">
                        <button id="changeProfilePicBtn" class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all">
                            Change Picture
                        </button>
                        <input type="file" id="profilePicInput" accept="image/*" class="hidden">
                    </div>

                    <!-- Profile Information Section -->
                    <div class="flex-1 space-y-6">
                        <div>
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="user" class="text-purple-500"></i> Profile Information
                            </h2>
                            <form id="profileForm" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Username</label>
                                        <input id="settingsUsername" type="text" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                                    </div>
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Display Name</label>
                                        <input id="settingsDisplayName" type="text" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Email</label>
                                    <input id="settingsEmail" type="email" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                                </div>
                                <div>
                                    <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Bio</label>
                                    <textarea id="settingsBio" placeholder="Tell us about yourself..." class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" rows="3"></textarea>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Location</label>
                                        <input id="settingsLocation" type="text" placeholder="City, Country" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                    </div>
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Website</label>
                                        <input id="settingsWebsite" type="url" placeholder="https://example.com" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                    </div>
                                </div>
                                <div class="flex justify-end gap-2 pt-4">
                                    <button type="button" id="cancelProfileChanges" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">Cancel</button>
                                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">Save Changes</button>
                                </div>
                            </form>
                        </div>

                        <div class="border-t border-white/10 pt-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="bell" class="text-purple-500"></i> Notification Preferences
                            </h2>
                            <div class="space-y-3">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm">Email notifications</span>
                                    <input type="checkbox" id="emailNotifications" class="w-4 h-4 text-purple-600 bg-gray-800 border-gray-600 rounded focus:ring-purple-500">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm">Push notifications</span>
                                    <input type="checkbox" id="pushNotifications" class="w-4 h-4 text-purple-600 bg-gray-800 border-gray-600 rounded focus:ring-purple-500">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm">New story alerts</span>
                                    <input type="checkbox" id="storyAlerts" class="w-4 h-4 text-purple-600 bg-gray-800 border-gray-600 rounded focus:ring-purple-500">
                                </label>
                            </div>
                        </div>

                        <div class="border-t border-white/10 pt-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="shield" class="text-purple-500"></i> Privacy & Security
                            </h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Current Password</label>
                                    <input id="currentPassword" type="password" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">New Password</label>
                                        <input id="newPassword" type="password" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                    </div>
                                    <div>
                                        <label class="text-xs uppercase tracking-widest text-gray-400 block mb-2">Confirm New Password</label>
                                        <input id="confirmNewPassword" type="password" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                    </div>
                                </div>
                                <button id="changePasswordBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">Change Password</button>
                            </div>
                        </div>

                        <div class="border-t border-white/10 pt-6">
                            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="trash-2" class="text-red-500"></i> Danger Zone
                            </h2>
                            <div class="space-y-4">
                                <p class="text-sm text-gray-400">Once you delete your account, there is no going back. Please be certain.</p>
                                <button id="deleteAccountBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex justify-center">
                <button id="backToHomeBtn" class="glass px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wider hover:bg-purple-600 transition-all flex items-center gap-2">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> <span>Back to Home</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Dialog -->
    <dialog id="adminDialog" class="rounded-xl p-0 border-0 shadow-2xl" style="max-width: 90vw;">
        <form id="adminForm" method="dialog" class="bg-[#18181b] text-white rounded-xl p-8 flex flex-col gap-4 min-w-[300px]">
            <h2 class="text-lg font-bold mb-2">Admin Login</h2>
            <input id="adminPassword" type="password" placeholder="Enter admin password" class="rounded px-3 py-2 bg-[#23232b] border border-gray-700 focus:outline-none focus:ring-2 focus:ring-purple-500" required>
            <div class="flex gap-2 mt-2">
                <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">Login</button>
                <button type="button" id="adminCancel" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
            </div>
            <p id="adminError" class="text-red-500 text-xs hidden">Incorrect password.</p>
        </form>
    </dialog>

    <dialog id="adminPanel" class="rounded-xl p-0 border-0 shadow-2xl" style="max-width: 90vw;">
        <div class="bg-[#18181b] text-white rounded-xl p-8 flex flex-col gap-4 min-w-[300px]">
            <h2 class="text-lg font-bold mb-4">Admin Panel</h2>
            <p class="mb-2">Select a site to view its documentation:</p>
            <div class="flex flex-col gap-3">
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-docs-neote/">Epsilon Neote</button>
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-docs-editz/">Epsilon Editz</button>
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-doc-aproxi/">Epsilon Aproxi</button>
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-docs-heckle/">Epsilon Heckle</button>
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-docs-academics/">Epsilon Academics</button>
                <button class="admin-doc-btn bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded" data-doc-link="https://epsilonneon-sketch.github.io/epsilon-admin-dashboard/">Epsilon admin dashboard</button>
            </div>
            <button id="adminPanelClose" class="mt-6 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Close</button>
        </div>
    </dialog>

    <!-- Auth Dialog -->
    <dialog id="authDialog" class="rounded-xl p-0 border-0 shadow-2xl bg-transparent" style="max-width: 90vw;">
        <div class="bg-[#18181b] text-white rounded-xl p-8 flex flex-col gap-6 min-w-[320px] glass border border-white/10">
            <div class="flex justify-between items-center">
                <h2 id="authTitle" class="text-2xl font-bold">Create Account</h2>
                <button type="button" id="authClose" class="text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
            </div>
            
            <form id="authForm" class="flex flex-col gap-4">
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Username</label>
                    <input id="authUsername" type="text" placeholder="warren_epsilon" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                </div>
                <div class="space-y-2" id="emailGroup">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Email</label>
                    <input id="authEmail" type="email" placeholder="warren@epsilon.com" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                </div>
                <div class="space-y-2" id="displayNameGroup">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Display Name (Optional)</label>
                    <input id="authDisplayName" type="text" placeholder="Warren Adrian" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                </div>
                <div class="space-y-2" id="bioGroup">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Bio (Optional)</label>
                    <textarea id="authBio" placeholder="Tell us about yourself..." class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" rows="3"></textarea>
                </div>
                <div class="space-y-2">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Password</label>
                    <input id="authPassword" type="password" placeholder="••••••••" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                </div>
                <div class="space-y-2" id="confirmPasswordGroup">
                    <label class="text-xs uppercase tracking-widest text-gray-400">Confirm Password</label>
                    <input id="authConfirmPassword" type="password" placeholder="••••••••" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all" required>
                </div>
                
                <button type="submit" id="authSubmit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg mt-2 transition-all shadow-lg shadow-purple-500/20">
                    Create Account
                </button>
                
                <p class="text-center text-sm text-gray-400">
                    <span id="authToggleText">Already have an account?</span> 
                    <button type="button" id="authToggleBtn" class="text-purple-400 hover:underline ml-1">Log In</button>
                </p>
                <p id="authError" class="text-red-500 text-xs text-center hidden"></p>
            </form>
        </div>
    </dialog>

    <script>
        // Initialize Supabase
        const { createClient } = supabase;
        const supabaseUrl = 'https://geumckprpbmgeuujrnnw.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdldW1ja3BycGJtZ2V1dWpybm53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NzgwMTUsImV4cCI6MjA4NTQ1NDAxNX0.bmKDSUajW0-ccLEeYYLpUTTJonSDQY_b1g8pgoA89xI';
        const supabaseClient = createClient(supabaseUrl, supabaseAnonKey);

        // Initialize Lucide Icons
        lucide.createIcons();

        // Global variables
        let currentUser = null;
        let currentFilter = 'all';

        // Page Navigation
        const homePage = document.getElementById('homePage');
        const postsPage = document.getElementById('postsPage');
        const settingsPage = document.getElementById('settingsPage');
        const homeBtn = document.getElementById('homeBtn');
        const postsBtn = document.getElementById('postsBtn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');

        function showPage(page) {
            homePage.classList.remove('active');
            postsPage.classList.remove('active');
            settingsPage.classList.remove('active');
            
            page.classList.add('active');
            
            // Re-initialize Lucide icons for the new page
            lucide.createIcons();
            
            // If showing posts page, load posts
            if (page === postsPage) {
                loadPosts();
            }
        }

        homeBtn.addEventListener('click', () => showPage(homePage));
        postsBtn.addEventListener('click', () => showPage(postsPage));
        backToHomeBtn.addEventListener('click', () => showPage(homePage));

        // Notification helper
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Auth & Settings Logic
        const authBtn = document.getElementById('authBtn');
        const authBtnText = document.getElementById('authBtnText');
        const settingsBtn = document.getElementById('settingsBtn');
        const authDialog = document.getElementById('authDialog');
        const authClose = document.getElementById('authClose');
        const authForm = document.getElementById('authForm');
        const authTitle = document.getElementById('authTitle');
        const authSubmit = document.getElementById('authSubmit');
        const authToggleBtn = document.getElementById('authToggleBtn');
        const authToggleText = document.getElementById('authToggleText');
        const emailGroup = document.getElementById('emailGroup');
        const displayNameGroup = document.getElementById('displayNameGroup');
        const bioGroup = document.getElementById('bioGroup');
        const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
        const authError = document.getElementById('authError');
        
        const profileForm = document.getElementById('profileForm');
        const settingsUsername = document.getElementById('settingsUsername');
        const settingsDisplayName = document.getElementById('settingsDisplayName');
        const settingsEmail = document.getElementById('settingsEmail');
        const settingsBio = document.getElementById('settingsBio');
        const settingsLocation = document.getElementById('settingsLocation');
        const settingsWebsite = document.getElementById('settingsWebsite');
        const cancelProfileChanges = document.getElementById('cancelProfileChanges');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const profilePicPreview = document.getElementById('profilePicPreview');
        const changeProfilePicBtn = document.getElementById('changeProfilePicBtn');
        const profilePicInput = document.getElementById('profilePicInput');

        let isLoginMode = false;

        // Check for existing session on page load
        async function checkAuthState() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            
            if (session) {
                // Get user profile data
                const { data: profile } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', session.user.id)
                    .single();
                
                if (profile) {
                    currentUser = { ...session.user, ...profile };
                    updateUI();
                } else {
                    // Create profile if it doesn't exist
                    const { data: newProfile, error } = await supabaseClient
                        .from('profiles')
                        .insert([
                            { 
                                id: session.user.id,
                                username: session.user.email.split('@')[0],
                                display_name: session.user.user_metadata.display_name || session.user.email.split('@')[0],
                                email: session.user.email,
                                profile_pic: `https://picsum.photos/seed/${session.user.id}/200/200.jpg`
                            }
                        ])
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('Error creating profile:', error);
                    } else {
                        currentUser = { ...session.user, ...newProfile };
                        updateUI();
                    }
                }
            } else {
                updateUI();
            }
        }

        const updateUI = () => {
            if (currentUser) {
                authBtnText.textContent = currentUser.username || currentUser.email.split('@')[0];
                settingsBtn.classList.remove('hidden');
                
                // Update settings page
                settingsUsername.value = currentUser.username || '';
                settingsDisplayName.value = currentUser.display_name || '';
                settingsEmail.value = currentUser.email;
                settingsBio.value = currentUser.bio || '';
                settingsLocation.value = currentUser.location || '';
                settingsWebsite.value = currentUser.website || '';
                
                // Update profile picture if exists
                if (currentUser.profile_pic) {
                    profilePicPreview.src = currentUser.profile_pic;
                }
                
                // Show create post section on posts page
                document.getElementById('createPostSection').classList.remove('hidden');
                document.getElementById('newPostBtn').classList.remove('hidden');
                document.getElementById('emptyStateNewPostBtn').classList.remove('hidden');
            } else {
                authBtnText.textContent = 'Join Epsilon';
                settingsBtn.classList.add('hidden');
                
                // Hide create post section on posts page
                document.getElementById('createPostSection').classList.add('hidden');
                document.getElementById('newPostBtn').classList.add('hidden');
                document.getElementById('emptyStateNewPostBtn').classList.add('hidden');
            }
        };

        authBtn.addEventListener('click', () => {
            if (currentUser) {
                showPage(settingsPage);
            } else {
                authDialog.showModal();
            }
        });

        settingsBtn.addEventListener('click', () => {
            showPage(settingsPage);
        });

        authClose.addEventListener('click', () => authDialog.close());

        authToggleBtn.addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            authTitle.textContent = isLoginMode ? 'Login to Epsilon' : 'Create Account';
            authSubmit.textContent = isLoginMode ? 'Login' : 'Create Account';
            authToggleText.textContent = isLoginMode ? "Don't have an account?" : "Already have an account?";
            authToggleBtn.textContent = isLoginMode ? 'Sign Up' : 'Log In';
            
            // Toggle visibility of optional fields
            displayNameGroup.classList.toggle('hidden', isLoginMode);
            bioGroup.classList.toggle('hidden', isLoginMode);
            confirmPasswordGroup.classList.toggle('hidden', isLoginMode);
            
            // Adjust required attributes
            document.getElementById('authConfirmPassword').required = !isLoginMode;
            document.getElementById('authDisplayName').required = false;
            document.getElementById('authBio').required = false;
            
            authError.classList.add('hidden');
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('authUsername').value;
            const email = document.getElementById('authEmail').value;
            const displayName = document.getElementById('authDisplayName').value;
            const bio = document.getElementById('authBio').value;
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            
            // Validation for registration
            if (!isLoginMode && password !== confirmPassword) {
                authError.textContent = 'Passwords do not match';
                authError.classList.remove('hidden');
                return;
            }
            
            try {
                if (isLoginMode) {
                    // Sign in
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email,
                        password
                    });
                    
                    if (error) {
                        authError.textContent = error.message;
                        authError.classList.remove('hidden');
                        return;
                    }
                    
                    // Get user profile
                    const { data: profile } = await supabaseClient
                        .from('profiles')
                        .select('*')
                        .eq('id', data.user.id)
                        .single();
                    
                    if (profile) {
                        currentUser = { ...data.user, ...profile };
                        authDialog.close();
                        updateUI();
                        authForm.reset();
                        showNotification('Successfully logged in!');
                    }
                } else {
                    // Sign up
                    const { data, error } = await supabaseClient.auth.signUp({
                        email,
                        password,
                        options: {
                            data: {
                                display_name: displayName || username
                            }
                        }
                    });
                    
                    if (error) {
                        authError.textContent = error.message;
                        authError.classList.remove('hidden');
                        return;
                    }
                    
                    // Create profile
                    const { data: profile, error: profileError } = await supabaseClient
                        .from('profiles')
                        .insert([
                            { 
                                id: data.user.id,
                                username,
                                display_name: displayName || username,
                                email,
                                bio: bio || '',
                                profile_pic: `https://picsum.photos/seed/${data.user.id}/200/200.jpg`
                            }
                        ])
                        .select()
                        .single();
                    
                    if (profileError) {
                        console.error('Error creating profile:', profileError);
                        authError.textContent = 'Error creating profile. Please try again.';
                        authError.classList.remove('hidden');
                        return;
                    }
                    
                    currentUser = { ...data.user, ...profile };
                    authDialog.close();
                    updateUI();
                    authForm.reset();
                    showNotification('Account created successfully!');
                }
            } catch (error) {
                console.error('Authentication error:', error);
                authError.textContent = 'An unexpected error occurred. Please try again.';
                authError.classList.remove('hidden');
            }
        });

        // Profile form submission
        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) return;
            
            try {
                // Update profile in Supabase
                const { data, error } = await supabaseClient
                    .from('profiles')
                    .update({
                        username: settingsUsername.value,
                        display_name: settingsDisplayName.value || settingsUsername.value,
                        email: settingsEmail.value,
                        bio: settingsBio.value,
                        location: settingsLocation.value,
                        website: settingsWebsite.value
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) {
                    console.error('Error updating profile:', error);
                    showNotification('Error updating profile. Please try again.', 'error');
                    return;
                }
                
                // Update email in auth if changed
                if (settingsEmail.value !== currentUser.email) {
                    const { error: emailError } = await supabaseClient.auth.updateUser({
                        email: settingsEmail.value
                    });
                    
                    if (emailError) {
                        console.error('Error updating email:', emailError);
                        showNotification('Error updating email. Please try again.', 'error');
                        return;
                    }
                }
                
                // Update current user
                currentUser = { ...currentUser, ...data };
                updateUI();
                
                showNotification('Profile updated successfully!');
            } catch (error) {
                console.error('Profile update error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        });

        // Cancel profile changes
        cancelProfileChanges.addEventListener('click', () => {
            updateUI(); // Reset to current values
        });

        // Profile picture change
        changeProfilePicBtn.addEventListener('click', () => {
            profilePicInput.click();
        });

        profilePicInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                try {
                    // Upload image to Supabase Storage
                    const fileName = `${currentUser.id}/${Date.now()}`;
                    const { data: uploadData, error: uploadError } = await supabaseClient.storage
                        .from('profile-pics')
                        .upload(fileName, file);
                    
                    if (uploadError) {
                        console.error('Error uploading profile picture:', uploadError);
                        showNotification('Error uploading profile picture. Please try again.', 'error');
                        return;
                    }
                    
                    // Get public URL
                    const { data: urlData } = supabaseClient.storage
                        .from('profile-pics')
                        .getPublicUrl(fileName);
                    
                    // Update profile with new picture URL
                    const { data, error } = await supabaseClient
                        .from('profiles')
                        .update({ profile_pic: urlData.publicUrl })
                        .eq('id', currentUser.id)
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('Error updating profile picture:', error);
                        showNotification('Error updating profile picture. Please try again.', 'error');
                        return;
                    }
                    
                    // Update UI
                    profilePicPreview.src = urlData.publicUrl;
                    currentUser.profile_pic = urlData.publicUrl;
                    
                    showNotification('Profile picture updated successfully!');
                } catch (error) {
                    console.error('Profile picture upload error:', error);
                    showNotification('An unexpected error occurred. Please try again.', 'error');
                }
            }
        });

        // Change password
        changePasswordBtn.addEventListener('click', async () => {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            try {
                // First verify current password by attempting to sign in
                const { data: signInData, error: signInError } = await supabaseClient.auth.signInWithPassword({
                    email: currentUser.email,
                    password: currentPassword
                });
                
                if (signInError) {
                    showNotification('Current password is incorrect', 'error');
                    return;
                }
                
                // Update password
                const { data, error } = await supabaseClient.auth.updateUser({
                    password: newPassword
                });
                
                if (error) {
                    console.error('Error updating password:', error);
                    showNotification('Error updating password. Please try again.', 'error');
                    return;
                }
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmNewPassword').value = '';
                
                showNotification('Password changed successfully!');
            } catch (error) {
                console.error('Password change error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        });

        // Delete account
        deleteAccountBtn.addEventListener('click', async () => {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                try {
                    // Delete user's posts
                    await supabaseClient
                        .from('posts')
                        .delete()
                        .eq('user_id', currentUser.id);
                    
                    // Delete user's profile
                    await supabaseClient
                        .from('profiles')
                        .delete()
                        .eq('id', currentUser.id);
                    
                    // Delete user's authentication
                    const { error } = await supabaseClient.auth.admin.deleteUser(
                        currentUser.id
                    );
                    
                    if (error) {
                        console.error('Error deleting user:', error);
                        showNotification('Error deleting account. Please try again.', 'error');
                        return;
                    }
                    
                    // Sign out
                    await supabaseClient.auth.signOut();
                    currentUser = null;
                    
                    // Go to home page and update UI
                    showPage(homePage);
                    updateUI();
                    
                    showNotification('Account deleted successfully');
                } catch (error) {
                    console.error('Account deletion error:', error);
                    showNotification('An unexpected error occurred. Please try again.', 'error');
                }
            }
        });

        // Posts functionality
        const postForm = document.getElementById('postForm');
        const postTitle = document.getElementById('postTitle');
        const postCategory = document.getElementById('postCategory');
        const postContent = document.getElementById('postContent');
        const postsContainer = document.getElementById('postsContainer');
        const emptyState = document.getElementById('emptyState');
        const newPostBtn = document.getElementById('newPostBtn');
        const emptyStateNewPostBtn = document.getElementById('emptyStateNewPostBtn');
        const cancelPost = document.getElementById('cancelPost');
        const createPostSection = document.getElementById('createPostSection');
        const filterBtns = document.querySelectorAll('.filter-btn');

        // Show/hide create post form
        newPostBtn.addEventListener('click', () => {
            createPostSection.classList.remove('hidden');
            postTitle.focus();
        });

        emptyStateNewPostBtn.addEventListener('click', () => {
            createPostSection.classList.remove('hidden');
            postTitle.focus();
        });

        cancelPost.addEventListener('click', () => {
            createPostSection.classList.add('hidden');
            postForm.reset();
        });

        // Filter posts
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active state
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Update filter and reload posts
                currentFilter = btn.getAttribute('data-filter');
                loadPosts();
            });
        });

        // Create post
        postForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('You must be logged in to create a post', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('posts')
                    .insert([
                        {
                            title: postTitle.value,
                            category: postCategory.value,
                            content: postContent.value,
                            user_id: currentUser.id
                        }
                    ])
                    .select()
                    .single();
                
                if (error) {
                    console.error('Error creating post:', error);
                    showNotification('Error creating post. Please try again.', 'error');
                    return;
                }
                
                // Reset form and hide
                postForm.reset();
                createPostSection.classList.add('hidden');
                
                // Reload posts
                loadPosts();
                
                showNotification('Story published successfully!');
            } catch (error) {
                console.error('Post creation error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        });

        // Load posts
        async function loadPosts() {
            try {
                let query = supabaseClient
                    .from('posts')
                    .select(`
                        *,
                        profiles:user_id (
                            username,
                            display_name,
                            profile_pic
                        )
                    `)
                    .order('created_at', { ascending: false });
                
                // Apply filter
                if (currentFilter !== 'all') {
                    query = query.eq('category', currentFilter);
                }
                
                const { data: posts, error } = await query;
                
                if (error) {
                    console.error('Error loading posts:', error);
                    showNotification('Error loading posts. Please try again.', 'error');
                    return;
                }
                
                // Clear container
                postsContainer.innerHTML = '';
                
                // Show/hide empty state
                if (posts.length === 0) {
                    emptyState.style.display = 'block';
                    return;
                } else {
                    emptyState.style.display = 'none';
                }
                
                // Create post cards
                posts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.className = 'glass p-6 rounded-3xl post-card';
                    
                    // Format date
                    const postDate = new Date(post.created_at);
                    const formattedDate = postDate.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    
                    // Check if current user liked this post
                    const isLiked = currentUser && post.liked_by && post.liked_by.includes(currentUser.id);
                    
                    postCard.innerHTML = `
                        <div class="flex items-center mb-4">
                            <img src="${post.profiles.profile_pic || `https://picsum.photos/seed/${post.user_id}/200/200.jpg`}" alt="${post.profiles.display_name}" class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h3 class="font-semibold">${post.profiles.display_name}</h3>
                                <p class="text-xs text-gray-400">@${post.profiles.username} · ${formattedDate}</p>
                            </div>
                        </div>
                        <h2 class="text-xl font-bold mb-2">${post.title}</h2>
                        <div class="mb-3">
                            <span class="text-xs px-2 py-1 bg-purple-600/20 text-purple-400 rounded-full">${post.category}</span>
                        </div>
                        <p class="text-gray-300 mb-4 line-clamp-3">${post.content}</p>
                        <div class="flex justify-between items-center">
                            <button class="like-btn flex items-center gap-1 text-sm ${isLiked ? 'text-red-500' : 'text-gray-400'} hover:text-red-500 transition-colors" data-post-id="${post.id}">
                                <i data-lucide="heart" class="w-4 h-4 ${isLiked ? 'fill-current' : ''}"></i>
                                <span>${post.likes || 0}</span>
                            </button>
                            <button class="read-more-btn text-purple-400 text-sm font-semibold hover:underline" data-post-id="${post.id}">
                                Read More
                            </button>
                        </div>
                    `;
                    
                    postsContainer.appendChild(postCard);
                });
                
                // Re-initialize Lucide icons
                lucide.createIcons();
                
                // Add event listeners to like buttons
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', handleLikePost);
                });
                
                // Add event listeners to read more buttons
                document.querySelectorAll('.read-more-btn').forEach(btn => {
                    btn.addEventListener('click', handleReadMore);
                });
            } catch (error) {
                console.error('Posts loading error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        }

        // Handle like post
        async function handleLikePost(e) {
            const postId = e.currentTarget.getAttribute('data-post-id');
            
            if (!currentUser) {
                showNotification('You must be logged in to like a post', 'error');
                return;
            }
            
            try {
                // Get current post
                const { data: post, error: fetchError } = await supabaseClient
                    .from('posts')
                    .select('likes, liked_by')
                    .eq('id', postId)
                    .single();
                
                if (fetchError) {
                    console.error('Error fetching post:', fetchError);
                    showNotification('Error liking post. Please try again.', 'error');
                    return;
                }
                
                // Prepare updated liked_by array
                let likedBy = post.liked_by || [];
                let likes = post.likes || 0;
                
                // Toggle like
                const userLikedIndex = likedBy.indexOf(currentUser.id);
                
                if (userLikedIndex === -1) {
                    // User hasn't liked yet, add like
                    likedBy.push(currentUser.id);
                    likes++;
                } else {
                    // User already liked, remove like
                    likedBy.splice(userLikedIndex, 1);
                    likes--;
                }
                
                // Update post
                const { data, error } = await supabaseClient
                    .from('posts')
                    .update({
                        likes,
                        liked_by: likedBy
                    })
                    .eq('id', postId)
                    .select()
                    .single();
                
                if (error) {
                    console.error('Error updating post like:', error);
                    showNotification('Error liking post. Please try again.', 'error');
                    return;
                }
                
                // Reload posts
                loadPosts();
            } catch (error) {
                console.error('Post like error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        }

        // Handle read more
        async function handleReadMore(e) {
            const postId = e.currentTarget.getAttribute('data-post-id');
            
            try {
                // Get post with author profile
                const { data: post, error } = await supabaseClient
                    .from('posts')
                    .select(`
                        *,
                        profiles:user_id (
                            username,
                            display_name,
                            profile_pic
                        )
                    `)
                    .eq('id', postId)
                    .single();
                
                if (error) {
                    console.error('Error fetching post:', error);
                    showNotification('Error loading post. Please try again.', 'error');
                    return;
                }
                
                // Format date
                const postDate = new Date(post.created_at);
                const formattedDate = postDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Check if current user liked this post
                const isLiked = currentUser && post.liked_by && post.liked_by.includes(currentUser.id);
                
                // Create modal for full post
                const postModal = document.createElement('dialog');
                postModal.className = 'rounded-xl p-0 border-0 shadow-2xl bg-transparent';
                postModal.style.maxWidth = '90vw';
                
                postModal.innerHTML = `
                    <div class="bg-[#18181b] text-white rounded-xl p-8 max-w-3xl glass border border-white/10">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center">
                                <img src="${post.profiles.profile_pic || `https://picsum.photos/seed/${post.user_id}/200/200.jpg`}" alt="${post.profiles.display_name}" class="w-12 h-12 rounded-full mr-3">
                                <div>
                                    <h3 class="font-semibold text-lg">${post.profiles.display_name}</h3>
                                    <p class="text-sm text-gray-400">@${post.profiles.username} · ${formattedDate}</p>
                                </div>
                            </div>
                            <button type="button" class="close-modal text-gray-400 hover:text-white">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <h2 class="text-2xl font-bold mb-3">${post.title}</h2>
                        <div class="mb-4">
                            <span class="text-sm px-3 py-1 bg-purple-600/20 text-purple-400 rounded-full">${post.category}</span>
                        </div>
                        <div class="text-gray-300 whitespace-pre-wrap mb-6">${post.content}</div>
                        <div class="flex justify-between items-center pt-4 border-t border-white/10">
                            <button class="like-btn flex items-center gap-2 ${isLiked ? 'text-red-500' : 'text-gray-400'} hover:text-red-500 transition-colors" data-post-id="${post.id}">
                                <i data-lucide="heart" class="w-5 h-5 ${isLiked ? 'fill-current' : ''}"></i>
                                <span>${post.likes || 0} ${post.likes === 1 ? 'Like' : 'Likes'}</span>
                            </button>
                            <button type="button" class="close-modal bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                Close
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(postModal);
                postModal.showModal();
                
                // Initialize icons in modal
                lucide.createIcons();
                
                // Add event listeners
                postModal.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        postModal.close();
                        postModal.remove();
                    });
                });
                
                postModal.querySelector('.like-btn').addEventListener('click', async () => {
                    await handleLikePost({ currentTarget: postModal.querySelector('.like-btn') });
                    // Update the like button in the modal
                    const { data: updatedPost } = await supabaseClient
                        .from('posts')
                        .select('likes, liked_by')
                        .eq('id', postId)
                        .single();
                    
                    if (updatedPost) {
                        const isLikedNow = currentUser && updatedPost.liked_by && updatedPost.liked_by.includes(currentUser.id);
                        const likeBtn = postModal.querySelector('.like-btn');
                        likeBtn.className = `like-btn flex items-center gap-2 ${isLikedNow ? 'text-red-500' : 'text-gray-400'} hover:text-red-500 transition-colors`;
                        likeBtn.innerHTML = `
                            <i data-lucide="heart" class="w-5 h-5 ${isLikedNow ? 'fill-current' : ''}"></i>
                            <span>${updatedPost.likes || 0} ${updatedPost.likes === 1 ? 'Like' : 'Likes'}</span>
                        `;
                        lucide.createIcons();
                    }
                });
            } catch (error) {
                console.error('Post view error:', error);
                showNotification('An unexpected error occurred. Please try again.', 'error');
            }
        }

        // Admin button and dialogs
        const adminBtn = document.getElementById('adminBtn');
        const adminDialog = document.getElementById('adminDialog');
        const adminForm = document.getElementById('adminForm');
        const adminPassword = document.getElementById('adminPassword');
        const adminError = document.getElementById('adminError');
        const adminCancel = document.getElementById('adminCancel');
        const adminPanel = document.getElementById('adminPanel');
        const adminPanelClose = document.getElementById('adminPanelClose');
        const searchInput = document.getElementById('search');

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            // Targeting all project cards across the Ecosystem, Partners, and Labs sections
            const projects = document.querySelectorAll('#homePage section .grid a.group');
            
            projects.forEach(project => {
                const title = project.querySelector('h2').textContent.toLowerCase();
                const description = project.querySelector('p').textContent.toLowerCase();
                
                // Match if the query is in the title OR the description
                if (title.includes(query) || description.includes(query)) {
                    project.style.display = ''; // Restore original display (usually block/flex)
                } else {
                    project.style.display = 'none';
                }
            });
        });

        adminBtn.addEventListener('click', () => {
            adminDialog.showModal();
            adminPassword.value = '';
            adminError.classList.add('hidden');
        });

        adminCancel.addEventListener('click', () => {
            adminDialog.close();
        });

        adminForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (adminPassword.value === '#15452575-ep') {
                adminDialog.close();
                adminPanel.showModal();
            } else {
                adminError.classList.remove('hidden');
            }
        });

        adminPanelClose.addEventListener('click', () => {
            adminPanel.close();
        });

        // Open docs in new tab
        adminPanel.addEventListener('click', (e) => {
            if (e.target.classList.contains('admin-doc-btn')) {
                const link = e.target.getAttribute('data-doc-link');
                window.open(link, '_blank');
            }
        });

        // Register the Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Epsilon SW Registered!', reg))
                    .catch(err => console.log('SW Registration Failed:', err));
            });
        }

        // Initialize UI on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthState();
        });
    </script>
</body>
</html> 
